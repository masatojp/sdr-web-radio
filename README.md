# Web SDR Monitor

このプロジェクトは、RTL-SDRドングルからの無線信号を、Webブラウザを通じてどこからでもモニターできるようにするリアルタイムSDR（Software-Defined Radio）アプリケーションです。

Node.jsをバックエンドとして使用し、`rtl_tcp`から受信したI/Qデータを処理して、AM/FM復調、音声ストリーミング、録音機能などを提供します。フロントエンドはスマートフォンでの利用に最適化されており、特にAndroidデバイスでのバックグラウンド再生に対応するための工夫が施されています。

## ✨ 主な特徴

- **WebベースのUI**: PCやスマートフォンのWebブラウザからSDRを操作・聴取できます。
- **AM/FM復調**: 一般的なAMおよび広帯域FMの復調に対応。
- **リアルタイム音声ストリーミング**: WebSocketを利用して、低遅延で音声をブラウザに配信します。
- **ビジュアル信号メーター**: RSSI（受信信号強度）と自動追従型のノイズフロア、スケルチ閾値を視覚的に表示します。
- **インテリジェント・スケルチ**:
    - ノイズレベルを自動で学習し、信号受信時のみ音声を出力します。
    - スケルチマージンを手動で調整可能。
- **周波数ブックマーク機能**:
    - よく聴く周波数を名前付きで保存できます。
    - フォルダを作成してブックマークを階層的に管理できます。
- **音声録音機能**:
    - 受信中の音声をサーバー側にFLAC形式で録音できます。
    - 録音ファイルはWeb UIから直接ダウンロード・削除が可能です。
- **Androidバックグラウンド再生対応**:
    - `MediaSession` APIを利用し、スマートフォンのロック画面に再生コントロールを表示します。
    - アプリがバックグラウンドに移行しても音声が途切れにくい設計。
- **パスワード保護**: 周波数変更操作にパスワード認証を要求できます。

## ⚙️ 必要なもの

- **Node.js**: v14以降を推奨。
- **RTL-SDR ドングル**: (例: RTL2832U)
- **rtl-sdr ソフトウェア**: `rtl_tcp`コマンドを実行するために必要です。
    - osmocom-sdr 等を参考に、お使いのOSにインストールしてください。

## 🚀 セットアップ

1.  **リポジトリのクローン**

    ```bash
    git clone <repository-url>
    cd <repository-directory>
    ```

2.  **依存パッケージのインストール**

    このプロジェクトは `ws` と `flac-bindings` に依存しています。

    ```bash
    npm install ws flac-bindings
    ```

3.  **設定の編集**

    `app.js` ファイルを開き、冒頭にある `CONFIG` オブジェクトを環境に合わせて編集します。

    ```javascript
    const CONFIG = {
        rtlHost: '127.0.0.1', // rtl_tcpが動作しているホスト
        rtlPort: 1234,        // rtl_tcpが使用するポート
        webPort: 3000,        // このアプリケーションが公開されるポート
        frequency: 93500000,  // 初期周波数 (Hz)
        mode: 'FM',           // 初期モード ('FM' or 'AM')
        sampleRate: 250000,   // RTL-SDRのサンプリングレート
        audioRate: 16000,     // 目標とする音声レート
        password: "admin",    // 周波数変更時に要求するパスワード
        // ... その他のパス設定
    };
    ```

## ⚡️ 使い方

1.  **RTL-TCPサーバーの起動**

    ターミナルを開き、`rtl_tcp` を起動します。`app.js`の`CONFIG`で設定したホストとポートで待機させます。

    ```bash
    # 例: デフォルト設定の場合
    rtl_tcp -a 127.0.0.1 -p 1234
    ```

2.  **Webアプリケーションの起動**

    別のターミナルを開き、Node.jsサーバーを起動します。

    ```bash
    node app.js
    ```

    サーバーが起動すると、コンソールに以下のようなメッセージが表示されます。

    ```
    [System] Starting Web SDR Monitor...
    [Web] Server running at http://0.0.0.0:3000
    [RTL-TCP] Connected.
    ```

3.  **ブラウザでアクセス**

    PCまたはスマートフォンのWebブラウザで、サーバーが動作しているマシンのIPアドレスとポート番号にアクセスします。

    - **ローカルPCから**: `http://localhost:3000`
    - **同じネットワーク内のスマホから**: `http://<サーバーのIPアドレス>:3000`

4.  **操作方法**

    - **START MONITOR**: `rtl_tcp`への接続を開始し、音声ストリーミングを受け取ります。
    - **モード選択**: `AM` / `FM` ボタンで復調モードを切り替えます。
    - **周波数変更**: 周波数をMHz単位で入力し、「TUNE」ボタンを押します。パスワード入力モーダルが表示されるので、`CONFIG`で設定したパスワードを入力してください。
    - **スケルチ調整**: `SQL MARGIN`スライダーで、ノイズフロアに対するスケルチの開放レベルを調整します。
    - **ブックマーク**: 「+ BM」や「+ FOLDER」で周波数を保存・管理できます。
    - **録音**: 「REC」ボタンで受信音声をサーバーに録音します。「STOP REC」で停止し、録音リストからダウンロードできます。

## 📝 ライセンス

このプロジェクトは MITライセンス の下で公開されています。